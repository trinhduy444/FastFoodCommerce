<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.css" rel="stylesheet" />
    <style>
        @media (min-width: 1025px) {
            .h-custom {
                height: 100vh !important;
            }
        }

        .number-input input[type="number"] {
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .number-input input[type=number]::-webkit-inner-spin-button,
        .number-input input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
        }

        .number-input button {
            -webkit-appearance: none;
            background-color: transparent;
            border: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0;
            position: relative;
        }

        .number-input button:before,
        .number-input button:after {
            display: inline-block;
            position: absolute;
            content: '';
            height: 2px;
            transform: translate(-50%, -50%);
        }

        .number-input button.plus:after {
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .number-input input[type=number] {
            text-align: center;
        }

        .number-input.number-input {
            border: 1px solid #ced4da;
            width: 10rem;
            border-radius: .25rem;
        }

        .number-input.number-input button {
            width: 2.6rem;
            height: .7rem;
        }

        .number-input.number-input button.minus {
            padding-left: 10px;
        }

        .number-input.number-input button:before,
        .number-input.number-input button:after {
            width: .7rem;
            background-color: #495057;
        }

        .number-input.number-input input[type=number] {
            max-width: 4rem;
            padding: .5rem;
            border: 1px solid #ced4da;
            border-width: 0 1px;
            font-size: 1rem;
            height: 2rem;
            color: #495057;
        }

        @media not all and (min-resolution:.001dpcm) {
            @supports (-webkit-appearance: none) and (stroke-color:transparent) {

                .number-input.def-number-input.safari_only button:before,
                .number-input.def-number-input.safari_only button:after {
                    margin-top: -.3rem;
                }
            }
        }

        .shopping-cart .def-number-input.number-input {
            border: none;
        }

        .shopping-cart .def-number-input.number-input input[type=number] {
            max-width: 2rem;
            border: none;
        }

        .shopping-cart .def-number-input.number-input input[type=number].black-text,
        .shopping-cart .def-number-input.number-input input.btn.btn-link[type=number],
        .shopping-cart .def-number-input.number-input input.md-toast-close-button[type=number]:hover,
        .shopping-cart .def-number-input.number-input input.md-toast-close-button[type=number]:focus {
            color: #212529 !important;
        }

        .shopping-cart .def-number-input.number-input button {
            width: 1rem;
        }

        .shopping-cart .def-number-input.number-input button:before,
        .shopping-cart .def-number-input.number-input button:after {
            width: .5rem;
        }

        .shopping-cart .def-number-input.number-input button.minus:before,
        .shopping-cart .def-number-input.number-input button.minus:after {
            background-color: #9e9e9e;
        }

        .shopping-cart .def-number-input.number-input button.plus:before,
        .shopping-cart .def-number-input.number-input button.plus:after {
            background-color: #4285f4;
        }
    </style>
</head>

<body>
    <section class="h-100 h-custom" style="background-color: #eee;">
        <div class="container h-100 py-5">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col">
                    <div class="card shopping-cart" style="border-radius: 15px;">
                        <div class="card-body text-black">

                            <div class="row">
                                <div class="col-lg-6 px-5 py-4">

                                    <h3 class="mb-5 pt-2 text-center fw-bold text-uppercase">Your products</h3>

                                    <div id="cart-items"> </div>

                                    <hr class="mb-4" style="height: 2px; background-color: #1266f1; opacity: 1;">

                                    <!-- <div class="d-flex justify-content-between px-x">
                                        <p class="fw-bold">Discount:</p>
                                        <p class="fw-bold">95$</p>
                                    </div> -->
                                    <div class="d-flex justify-content-between p-2 mb-2"
                                        style="background-color: #e1f5fe;">
                                        <h5 class="fw-bold mb-0">Total:</h5>
                                        <h5 class="fw-bold mb-0 totalPrice">0$</h5>
                                    </div>

                                </div>
                                <div class="col-lg-6 px-5 py-4">

                                    <h3 class="mb-5 pt-2 text-center fw-bold text-uppercase">Payment</h3>

                                    <form class="mb-5 delivery" method="post" action="/purchaseSuccess">

                                        <div class="form-outline mb-5">
                                            <input type="text" id="fullname" name="fullname"
                                                class="form-control form-control-lg" siez="17"
                                                placeholder="Input your name..." minlength="5" maxlength="30" />
                                            <label class="form-label" for="fullname">Your full name</label>
                                        </div>

                                        <div class="form-outline mb-5">
                                            <input type="text" id="address" name="address"
                                                class="form-control form-control-lg" siez="17"
                                                placeholder="Input your address..." />
                                            <label class="form-label" for="address">Your address</label>
                                        </div>
                                        <div class="form-outline mb-5">
                                            <input type="email" id="email" name="email"
                                                class="form-control form-control-lg" siez="17"
                                                placeholder="Input your email..." />
                                            <label class="form-label" for="email">Your email</label>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-5">
                                                <div class="form-outline">
                                                    <input type="tel" class="form-control form-control-lg" id="phone"
                                                        name="phone" size="7" minlength="9" maxlength="11" />
                                                    <label class="form-label" for="phone">Phone number</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-5">
                                                <div class="form-outline">
                                                    <input type="password" id="password" name="password"
                                                        class="form-control form-control-lg" size="1" />
                                                    <label class="form-label" for="password">Verified password</label>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="hidden" id="totalPrice" name="totalPrice" style="display:none">
                                        <input type="hidden" id="order_id" name="order_id" style="display:none">

                                        <p class="mb-5">Khi bạn đặt hàng đồng nghĩa với việc bạn đồng ý với <a
                                                href="#!">các điều khoản</a>.</p>

                                        <button type="submit" class="btn btn-primary btn-block btn-lg">Check
                                            out</button>

                                        <h5 class="fw-bold mb-5" style="position: absolute; bottom: 0;">
                                            <a href="/"><i class="fas fa-angle-left me-2"></i>Back to shopping</a>
                                        </h5>

                                    </form>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
<script>
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }



    const delivery = document.querySelector('.delivery');
    delivery.addEventListener('submit', function (event) {

        var cartItems = JSON.parse(localStorage.getItem('cart')) || [];

        document.querySelector('#totalPrice').value = localStorage.getItem('totalPrice');
        var totalPrice = document.querySelector('#totalPrice').value;

        var fullname = document.querySelector('#fullname').value;
        var address = document.querySelector('#address').value;
        var email = document.querySelector('#email').value;
        var phone = document.querySelector('#phone').value;
        var password = document.querySelector('#password').value;
        var loginpass = getCookie("loginInfoPass");

        //Create order id
        var Order_id = createID(phone);
        document.querySelector('#order_id').value = Order_id;
        var order_id2 = document.querySelector('#order_id').value;
        if (fullname == '' || address == '' || email == '' || phone == '' || password == '') {
            alert('Please fill in all the fields');
            event.preventDefault();
        } else {
            if (password != loginpass) {
                alert('Password is incorrect');
                event.preventDefault();
            }
            else {
                var data = {
                    orderid: order_id2,
                    cartItems: cartItems.id,
                    totalPrice: totalPrice,
                    fullname: fullname,
                    address: address,
                    email: email,
                    phone: phone,
                    password: password
                }
            }


            localStorage.setItem('data', JSON.stringify(data));
            // delivery.setAttribute('action', '/purchaseSuccess/'+order_id2);
        }
    });

    function createID(phoneNumber) {
        var today = new Date();
        var date = today.getDate();
        var month = today.getMonth() + 1;
        var hours = today.getHours();
        var minutes = today.getMinutes();
        var seconds = today.getSeconds();
        var lastThreeDigits = phoneNumber.substring(phoneNumber.length - 3);
        var orderID = `${date}${month}${hours}${minutes}${seconds}${lastThreeDigits}`;
        return orderID;
    }
    function updateTotalPrice() {
        var cartItems = JSON.parse(localStorage.getItem('cart')) || [];
        var totalPrice = 0;
        cartItems.forEach(function (item) {
            totalPrice += item.price * item.quantity;
        });
        document.querySelector('.totalPrice').textContent = totalPrice + '$';

        localStorage.setItem('totalPrice', totalPrice);

    }

    var cartItems = JSON.parse(localStorage.getItem('cart')) || [];

    cartItems.forEach(function (item) {
        updateTotalPrice();
        var product = '<div id="product-' + item.id + '" class="d-flex align-items-center mb-5">' +
            '<div class="flex-shrink-0">' +
            '<img src="' + item.image + '" class="img-fluid" style="width: 150px;" alt="">' +
            '</div>' +
            '<div class="flex-grow-1 ms-3">' +
            '<a href="#!" class="float-end text-black" onclick="removeCartItem(\'product-' + item.id + '\')"><i class="fas fa-times"></i></a>' +
            '<h5 class="text-primary">' + item.name + '</h5>' +
            '<h6 style="color: #9e9e9e;">Brand: ' + item.brand + '</h6>' +
            '<div class="d-flex align-items-center">' +
            '<p class="fw-bold mb-0 me-5 pe-3">' + item.price + '$' + '</p>' +
            '<div class="def-number-input number-input safari_only">' +
            '<button class="minus" type="button" onclick="decreaseQuantity(event,this)" data-id=' + item.id + '></button>' +
            '<input class="quantity fw-bold text-black" min="0" name="quantity" value="' + item.quantity + '" type="number">' +
            '<button class="plus" type="button" onclick="increaseQuantity(event,this)" data-id=' + item.id + '></button>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';
        document.getElementById('cart-items').innerHTML += product;
    });


    function removeCartItem(id) {
        var index;
        for (var i = 0; i < cartItems.length; i++) {
            if ('product-' + cartItems[i].id === id) {
                index = i;
                break;
            }
        }
        cartItems.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cartItems));
        document.getElementById(id).remove();
        window.location.reload();
    }

    function decreaseQuantity(event, button) {
        var id = event.target.dataset.id;
        console.log(id);
        var cartItems = JSON.parse(localStorage.getItem('cart')) || [];
        var itemIndex = cartItems.findIndex(item => item.id === id);
        if (itemIndex >= 0 && cartItems[itemIndex].quantity > 0) {
            cartItems[itemIndex].quantity -= 1;
            localStorage.setItem('cart', JSON.stringify(cartItems));
            updateTotalPrice();
        }
        button.parentNode.querySelector('input[type=number]').stepDown();
    }


    function increaseQuantity(event, button) {
        var id = event.target.dataset.id;
        console.log(id);
        var cartItems = JSON.parse(localStorage.getItem('cart')) || [];
        var itemIndex = cartItems.findIndex(item => item.id === id);
        if (itemIndex >= 0) {
            cartItems[itemIndex].quantity += 1;
            localStorage.setItem('cart', JSON.stringify(cartItems));
            updateTotalPrice();
        }
        button.parentNode.querySelector('input[type=number]').stepUp();
    }

</script>
<!-- MDB -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.js"></script>

</html>